library(metafor)
library(glmulti)
library(MuMIn)
library(ggplot2)
library(plyr)

datformsc <-
  structure(
    list(
      X = c(
        1L,
        2L,
        3L,
        4L,
        5L,
        6L,
        7L,
        8L,
        9L,
        10L,
        11L,
        12L,
        13L,
        14L,
        15L,
        16L,
        17L,
        18L,
        19L,
        27L
      ),
      CONTINENT = c(
        "Asia",
        "Asia",
        "Asia",
        "Europe",
        "Asia",
        "Asia",
        "Asia",
        "Asia",
        "Asia",
        "Asia",
        "Asia",
        "Asia",
        "Asia",
        "Asia",
        "Asia",
        "Asia",
        "N_America",
        "Europe",
        "Europe",
        "Asia"
      ),
      COUNTRY = c(
        "Indonesia",
        "Indonesia",
        "Indonesia",
        "Russia",
        "Brunei",
        "Brunei",
        "Indonesia",
        "Indonesia",
        "Indonesia",
        "Indonesia",
        "Indonesia",
        "Indonesia",
        "Indonesia",
        "Indonesia",
        "Indonesia",
        "Indonesia",
        "USA",
        "UK",
        "Russia",
        "Turkey"
      ),
      SETTING = c(
        "PSF",
        "PSF",
        "PSF",
        "Boreal_forest",
        "PSF",
        "PSF",
        "PSF",
        "PSF",
        "PSF",
        "PSF",
        "PSF",
        "PSF",
        "PSF",
        "PSF",
        "PSF",
        "PSF",
        "Boreal_forest",
        "Blanket_bog",
        "Boreal_forest",
        "Lake peatland"
      ),
      Latitude_D_D = c(
        -2.264582,
        -2.264582,
        -2.264582,
        55.627431,
        4.477778,
        4.477778,
        -2.327932,
        -2.327932,
        -2.327932,-2.327932,
        -2.327932,
        -2.327932,
        -2.327932,
        -2.327932,
        -2.327932,-2.327932,
        65.612289,
        54.66475,
        56.866667,
        37.621952
      ),
      Mean_T = c(
        232.4,
        248.2,
        249.2,
        3.1,
        53.7,
        24.6,
        542,
        0.089,
        95,
        537,
        268,
        5.44,
        6.52,
        0.0977,
        0.088,
        0.1141,
        3498,
        50.409,
        0.45,
        14.75
      ),
      Variation_T = c(
        18.5,
        20.1,
        13.8,
        1.5,
        17.1,
        2.6,
        26,
        0.028,
        20,
        22,
        9.4,
        0.53,
        0.72,
        0.0025,
        9e-04,
        0.0045,
        703,
        0.728,
        0.01,
        18.41
      ),
      n_T = c(18,
              18, 18, 4, 5, 4, 11, 5, 2, 3, 3, 5, 5, 6, 12, 6, 10, 8, 9, 50),
      Mean_C = c(
        302.6,
        302.6,
        302.6,
        3.1,
        44.9,
        24.1,
        513,
        0.075,
        114,
        494,
        494,
        5.077,
        5.077,
        0.1026,
        0.1026,
        0.1026,
        39620,
        49.625,
        0.43,
        145.1
      ),
      Variation_C = c(
        13.3,
        13.3,
        13.3,
        1.5,
        7.5,
        5.7,
        15,
        0.017,
        18,
        1,
        1,
        1.212,
        1.212,
        0.0069,
        0.0069,
        0.0069,
        3017,
        0.676,
        0.02,
        23.94
      ),
      n_C = c(12, 12, 12, 4, 5, 5, 6, 20, 2, 1.5,
              1.5, 5, 2.5, 1.6, 1.6, 1.6, 10, 8, 3, 46),
      Min_months_since_fire = c(
        192L,
        60L,
        60L,
        36L,
        15L,
        15L,
        168L,
        3L,
        36L,
        84L,
        84L,
        192L,
        60L,
        48L,
        192L,
        264L,
        16L,
        108L,
        12L,
        36L
      ),
      Repeat_Burn = c(
        "Y",
        "Y",
        "Y",
        "N",
        "Y",
        "Y",
        "Y",
        "Y",
        "Y",
        "Y",
        "Y",
        "N",
        "Y",
        "Y",
        "N",
        "N",
        "N",
        "Y",
        "Y",
        "N"
      ),
      Wildfire = c(
        "N",
        "N",
        "N",
        "Y",
        "Y",
        "Y",
        "Y",
        "Y",
        "Y",
        "Y",
        "Y",
        "Y",
        "Y",
        "Y",
        "Y",
        "Y",
        "Y",
        "N",
        "N",
        "Y"
      ),
      Maximum_Depth_cm = c(
        100L,
        100L,
        100L,
        150L,
        340L,
        340L,
        500L,
        450L,
        400L,
        280L,
        280L,
        300L,
        300L,
        800L,
        800L,
        800L,
        250L,
        200L,
        90L,
        150L
      ),
      Drained = c(
        "Y",
        "Y",
        "Y",
        "Y",
        "Y",
        "Y",
        "Y",
        "Y",
        "Y",
        "Y",
        "Y",
        "Y",
        "Y",
        "Y",
        "Y",
        "Y",
        "N",
        "N",
        "N",
        "Y"
      ),
      Grazed = c(
        "N",
        "N",
        "N",
        "N",
        "N",
        "N",
        "N",
        "N",
        "N",
        "N",
        "N",
        "N",
        "N",
        "N",
        "N",
        "N",
        "N",
        "N",
        "N",
        "N"
      ),
      Plantation = c(
        "N",
        "N",
        "N",
        "N",
        "N",
        "N",
        "N",
        "N",
        "N",
        "N",
        "N",
        "Y",
        "N",
        "N",
        "N",
        "N",
        "N",
        "N",
        "N",
        "Y"
      ),
      min_temp = c(
        22,
        22,
        22,
        -13,
        23.4,
        23.4,
        22.1,
        22.1,
        22.1,
        22.1,
        22.1,
        22.1,
        22.1,
        22.1,
        22.1,
        22.1,
        -27.6,
        -1.2,
        -22.7,
        -7.9
      ),
      max_temp = c(
        32.6,
        32.6,
        32.6,
        24.2,
        30.8,
        30.8,
        33.1,
        33.1,
        33.1,
        33.1,
        33.1,
        33.1,
        33.1,
        33.1,
        33.1,
        33.1,
        22.7,
        17.1,
        24.6,
        25
      ),
      avg_annual_temp = c(
        27.3,
        27.3,
        27.3,
        4.7,
        27.2,
        27.2,
        27.6,
        27.6,
        27.6,
        27.6,
        27.6,
        27.6,
        27.6,
        27.6,
        27.6,
        27.6,
        -4.3,
        6.4,
        -1.1,
        7.1
      ),
      avg_annual_precipitation = c(
        2413L,
        2413L,
        2413L,
        600L,
        3000L,
        3000L,
        2420L,
        2420L,
        2420L,
        2420L,
        2420L,
        2420L,
        2420L,
        2420L,
        2420L,
        2420L,
        308L,
        1570L,
        530L,
        607L
      ),
      temp_annual_range = c(
        10.5,
        10.5,
        10.5,
        37.3,
        7.4,
        7.4,
        11,
        11,
        11,
        11,
        11,
        11,
        11,
        11,
        11,
        11,
        50.3,
        18.28,
        47.3,
        32.9
      ),
      yi = c(
        -4.10161398062904,
        -2.98314880144719,-3.81857122588845,
        0,
        0.601646858508129,
        0.0958602213436635,
        1.20036262100519,
        0.698998120109826,
        -0.563409777254473,
        1.44534301887351,
        -17.7584214694567,
        0.350321670266792,
        1.40075732530032,-1.28747835347036,
        -7.58405395842164,
        2.0510973262964,
        -15.7919438159419,
        1.05498262002566,
        1.45898891118238,
        -6.08852634406068
      ),
      vi = c(
        0.419276176323749,
        0.287208501748486,
        0.381913659008609,
        0.5,
        0.418098947117635,
        0.450510510113114,
        0.299954299396536,
        0.259771967438341,
        1.03967882213824,
        1.23211293802293,
        36.0401703429847,
        0.406136263632926,
        0.730808072292167,
        0.900719331841321,
        2.82296107025432,
        1.06844299837326,
        6.43463723714667,
        0.284780885267382,
        0.533138137900826,
        0.234812844196871
      )
    ),
    row.names = c(
      1L,
      2L,
      3L,
      4L,
      5L,
      6L,
      7L,
      8L,
      9L,
      10L,
      11L,
      12L,
      13L,
      14L,
      15L,
      16L,
      17L,
      18L,
      19L,
      27L
    ),
    class = "data.frame"
  )


#reclassifying wildfires to 0 and 1
datformsc$Wildfire<-ifelse(datformsc$Wildfire=="Y",1,0)

#making the rma model
tmc<-rma(yi, vi, mods = ~ temp_annual_range+max_temp+min_temp+Wildfire, method="ML", data=datformsc)
tmc

#Getting the means from the continuous variables
meantemprange<-mean(datformsc$temp_annual_range)
meanmaxtemp<-mean(datformsc$max_temp)
meanmintemp<-mean(datformsc$min_temp)

temp_annual_range <- datformsc$temp_annual_range
max_temp <- datformsc$max_temp
min_temp<-datformsc$min_temp

#This is where the predictions are too large
outputc<-as.data.frame(predict(tmc,newmods=cbind(temp_annual_range,meanmaxtemp,meanmintemp,1)))
outputc<-cbind(outputc,datformsc)

outputc2<-as.data.frame(predict(tmc,newmods=cbind(meantemprange,max_temp,meanmintemp,1)))
outputc2<-cbind(outputc2,datformsc)

outputc3<-as.data.frame(predict(tmc,newmods=cbind(meantemprange,meanmaxtemp,datformsc$min_temp,1)))
outputc3<-cbind(outputc3,datformsc)

#Strangely, the wildfire prediction values are fine
outputc4<-as.data.frame(predict(tmc,newmods=cbind(meantemprange,meanmaxtemp,meanmintemp,datformsc$Wildfire)))
outputc4<-cbind(outputc4,datformsc)
